---
import BaseLayout from "../layouts/BaseLayout.astro";
---

<BaseLayout title="Registro">
  <div class="page-center">
    <h1 class="text-2xl font-bold mb-4">Registro</h1>

    <form id="registerForm" class="flex flex-col gap-4 max-w-sm">
      <div>
        <label class="block mb-1">Nombre</label>
        <input id="name" type="text" class="w-full p-2 border rounded" required />
        <p id="nameError" class="text-red-600 text-sm hidden">El nombre es obligatorio</p>
      </div>

      <div>
        <label class="block mb-1">Email</label>
        <input id="email" type="email" class="w-full p-2 border rounded" required />
        <p id="emailError" class="text-red-600 text-sm hidden">Email inválido</p>
      </div>

      <div>
        <label class="block mb-1">Contraseña</label>
        <input id="password" type="password" class="w-full p-2 border rounded" required />
        <p id="passwordError" class="text-red-600 text-sm hidden">La contraseña es obligatoria</p>
      </div>

      <button
        type="submit"
        class="bg-green-600 text-white py-2 rounded hover:bg-green-700"
      >
        Crear cuenta
      </button>
    </form>

    <script>
      const form = document.getElementById("registerForm") as HTMLFormElement;

      form.addEventListener("submit", (e) => {
        e.preventDefault();

        const name = document.getElementById("name") as HTMLInputElement;
        const email = document.getElementById("email") as HTMLInputElement;
        const password = document.getElementById("password") as HTMLInputElement;

        const nameError = document.getElementById("nameError") as HTMLParagraphElement;
        const emailError = document.getElementById("emailError") as HTMLParagraphElement;
        const passwordError = document.getElementById("passwordError") as HTMLParagraphElement;

        let valid = true;

        if (name.value.trim() === "") {
          nameError.classList.remove("hidden");
          valid = false;
        } else {
          nameError.classList.add("hidden");
        }

        if (!email.value.includes("@")) {
          emailError.classList.remove("hidden");
          valid = false;
        } else {
          emailError.classList.add("hidden");
        }

        if (password.value.trim() === "") {
          passwordError.classList.remove("hidden");
          valid = false;
        } else {
          passwordError.classList.add("hidden");
        }

        if (!valid) return;

        localStorage.setItem("user", JSON.stringify({
          name: name.value,
          email: email.value
        }));

        window.location.href = "/profile";
      });
    </script>
  </div>
</BaseLayout>
